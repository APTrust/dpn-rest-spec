## Overview

A Transfer represents the exchange of a content between the Node API Server to a specific Node API Client.

## Transfer Data Structure

The following is the data structure for an individual transfer:
* **node** - String of target node namespace .
* **dpn_object_id** - String of the dpn object identifier this applies to.
* **status** - String of single character code representing the status of the transfer.
    * 'P' - Pending: staged for transfer and awaiting response from target node.
    * 'A' - Accept:  set by the target node to indicate it will perform transfer.
    * 'R' - Reject: set by the target node to indicate it will not perform the transfer.
    * 'C' - Confirm: set by the local node after it receives all data to confirm a good transfer.
* **event_id** - String used to identify this particular transfer in detail views.
* **protocol** - Single character String used to identify the transfer protocol.
* **link** - String of transfer link to be used for the specified protocol.
* **size** - Int of size of the object in bytes.
* **receipt** - null or String of fixity generated by the target node after transfer. 
* **fixity** - null or boolean set by local node indicating match result of receipt.
* **valid** - null or boolean set by target node to record results of bag validation.
* **created_on** - String in DPN DateTime Format of the record creation date.
* **updated_on** - String in DPN DateTime Format of last record update. 

**Example Transfer:**

```json
{
    "node":"chron",
    "dpn_object_id":"8287ee9e-74f1-490b-8209-800985361134",
    "status":"P",
    "event_id":"aptrust-1665",
    "protocol":"R",
    "link":"chrondpn@dpn.nodename.org:outgoing/8287ee9e-74f1-490b-8209-800985361134.tar",
    "size":543891175,
    "receipt":null,
    "fixity":null,
    "valid":null,
    "created_on":"2014-11-11T00:27:20.295603Z",
    "updated_on":"2014-11-11T00:27:20.297468Z"
}
```

## Supported HTTP Methods

### **Endpoint:** `/api-v1/transfer/`

#### GET Operation (EXTERNAL)

Returns a list of Transfers from the server node and additional fields needed for counting and paging through the return list.

**Restrictions**
* By default transfers must be filtered to only the requesting users node.
* API Admins have no node Filter applied and can see all transfers.

**Querystring Options**
* **dpn_object_id** = <exact id> to FILTER by exact DPN Object ID value.
* **status** = [P|A|R|C] to FILTER by Pending, Accept, Reject or Confirmed status
* **fixity** = [true|false|none] to FILTER by fixity status.
* **valid** = [true|false|none] to FILTER by validation status.
* **node** = <exact name> FILTER by the namespace used for the node. (i.e. "aptrust"|"chron"|"sdr"...)
* **created_on** = <dpn date format> to ORDER the return by record creation date. (prepend with '-' to reverse order)
* **updated_on** = <dpn date format> to ORDER the return by last update. (prepend with '-' to reverse order)
* **page_size** = <int> to set the max number of results per page.

**Example Return:**

**url:** `/api-v1/transfer/?page_size=2`

```json
{
    "count":110,
    "next":"http://localhost:8000/api-v1/transfer/?page=2",
    "previous":null,
    "results":[
        {
            "node":"chron",
            "dpn_object_id":"8287ee9e-74f1-490b-8209-800985361134",
            "status":"P",
            "event_id":"aptrust-1665",
            "protocol":"R",
            "link":"chrondpn@dpn.nodename.org:outgoing/8287ee9e-74f1-490b-8209-800985361134.tar",
            "size":543891175,
            "receipt":null,
            "fixity":null,
            "valid":null,
            "created_on":"2014-11-11T00:27:20.295603Z",
            "updated_on":"2014-11-11T00:27:20.297468Z"
        },
        {
            "node":"chron",
            "dpn_object_id":"8044ea1a-cba5-44e7-a4d5-122f649f81a4",
            "status":"A",
            "event_id":"aptrust-1664",
            "protocol":"R",
            "link":"chrondpn@dpn.nodename.org:outgoing/8044ea1a-cba5-44e7-a4d5-122f649f81a4.tar",
            "size":3239653228,
            "receipt":null,
            "fixity":null,
            "valid":null,
            "created_on":"2014-11-11T00:27:20.266521Z",
            "updated_on":"2014-11-13T17:18:28.245754Z"
        }
    ]
}
```

#### POST Operation (INTERNAL)

Creates new Transfers.  It requires the following data in the body of the post in order to create the transfer.

Data strucutre:
* **dpn_object_id:** String of the dpn object id to look up the registry entry.
* **link** String of the link to use for downloading the file.
* **node** String of the node namespace to link the node and filter any API User access.
* **size** Int of the size of the package in bytes.
* **exp_fixity** String of fixity value to compare to the 'receipt' field and set the fixity field to true or false, hidden in all API returns.

**Restrictions**
*  This operation is limited to api_admin users only.

**POST Body Example:**
```json
{
    "dpn_object_id":"8044ea1a-cba5-44e7-a4d5-122f649f81a4",
    "link":"sshaccount@dpnserver.test.org:8044ea1a-cba5-44e7-a4d5-122f649f81a4.tar",
    "node":"chron",
    "size":3239653228,
    "exp_fixity":"eced7e98269750587531381811b2a59f"
}
```

### **Endpoint:** `/api-v1/transfer/<event_id>/`

#### GET Operation (EXTERNAL)

This displays data about a single Transfer based in its event_id.

**Restrictions**
* API Users belonging to the target node.
* SuperUsers

#### PUT Operation (EXTERNAL)

Updates the transfer indicated by the event_id in the URL.

**Restrictions**
* API Users belonging to the target node.
* API Admins.
* READ ONLY FIELDS: "link", "size", "fixity", "event_id", "protocol", "created_on", "updated_on", "valid", "dpn_object_id", "node"
* API Users can only set status of Accept (A) or Reject (R).
